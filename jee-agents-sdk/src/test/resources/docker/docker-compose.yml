version: '3'
services:
  openam:
    image: openidentityplatform/openam:latest
    ports:
      - "8080:8080"
    hostname: openam.example.com
    environment:
      CATALINA_OPTS: "-server -XX:+UseG1GC -XX:+UseContainerSupport -Dcom.iplanet.services.configpath=/usr/openam/config -Dcom.sun.identity.configuration.directory=/usr/openam/config -DXUI.enable=false"
    volumes:
      - ./persistence/openam:/usr/openam/config
    user: root

  agent:
    build: .
    environment:
      OPENAM_SERVER: http://openam.example.com:8080/openam
      OPENAM_AGENT_USER: test
      OPENAM_AGENT_PASSWORD: papassword
      OPENAM_AGENT_URL: http://agent.example.com:8080/manager
    hostname: agent.example.com
    ports:
      - "8081:8080"
